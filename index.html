<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCRUMptious</title>
    <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
    <header>
        <nav>
            <a style="all:unset;cursor:pointer;" href="./index.html"><h1>SCRUMptious</h1></a>
            <a href="./suggestions.html">Suggested</a>
            <a href="./recipes.html">Recipes</a>
            <a href="./calendar.html">Calendar</a>
            <a href="./groceryList.html">Grocery List</a>
            <a href="./pantryPage.html">Pantry</a>
            <a href="./search.html">Search</a>
        </nav>
    </header>

    <main>
        <div>
            <h2>Select an Account</h2>
            <table id="accountDisplay" style="max-width:max-content">

            </table>
            <form id="addAcc">
                <div>
                    <input type="text" id="accNameNew" value="" placeholder="Your NEW Name Here" required>
                </div>
                <div id="restrictField">
                    <button type="button" id="addRestrictButton" onclick="addRestriction()">Add Restriction</button>
                    <input type="text" id="accAddRestriction0" value="" placeholder="Restriction">
                </div>
                <div>
                    <button type="button" onclick="addAccounts()">Add Account</button>
                </div>
            </form>
        </div>
    </main>
    <script>
        console.log("Script loaded");
        const { ipcRenderer } = require('electron');
        const fs = require('fs');

        document.addEventListener('DOMContentLoaded', (event) => {
          console.log("ready");
          ipcRenderer.send('accountPageReady');
        });

        const tableBody = document.querySelector('#accountPrint');

        let accountList = [];
        
        ipcRenderer.on('accountPrint', (event, account) => {
            console.log('account data received:', account);
            populateAccounts(account);
        });

        ipcRenderer.on('accountSwitch', (event, account) => {
            console.log('switching account to:', account);
            switchAccounts(account);
        });

        ipcRenderer.on('accountAdd', (event, account) => {
            console.log('adding account data:', account);
            addAccounts(account);
        });

        ipcRenderer.on('accountRemove', (event, account) => {
            console.log('removing account data:', account);
            removeAccounts(account);
        });

        function populateAccounts(account) {
            accountList = account;
            const tableList = document.getElementById('accountDisplay');
            tableList.innerHTML = ``;
            for (let i = 0; i < account.length; i++) {
                tableList.innerHTML += 
                `<tr id = accountDisplay${i}>
                    <td>${account[i].username}</td>
                    <td><button type="button" onclick="switchAccounts(${i})">Select</button></td>
                    <td><button type="button" onclick="removeAccounts(${i})">Delete</button></td>
                </tr>`;
            }
        };

        function addRestriction() {
            let allergyList = document.getElementById('restrictField');
            console.log(allergyList.innerHTML.split('\n'));
            allergyList.innerHTML += `\n<input type="text" id="accAddRestriction${allergyList.innerHTML.split('\n').length - 3}" value="" placeholder="Restriction">`;
        }

        function switchAccounts(account) {
            for (let i = 0; i < accountList.length; i++) {
                accountList[i].selected = 0;
            }
            accountList[account].selected = 1;
            console.log(account + " (" + accountList[account].username + ") is now selected");
            console.log(accountList);
            window.location.href = "./suggestions.html";
        };

        function addAccounts(account) {
            console.log("add " + account);
            account = new Account();

            for (let i = 0; i < accountList.length; i++) {
                accountList[i].selected = 0;
            }
            account.selected = 1;

            account.username = 0;
            account.restrictions = 0;
            console.log(account);
            accountList.push(account);
            ipcRenderer.send('accountPageReady');
            
        };

        function removeAccounts(account) {
            console.log("remove " + account);
            accountList.splice(account, 1);
            ipcRenderer.send('accountPageReady');
        };

    </script>
</body>
</html>
